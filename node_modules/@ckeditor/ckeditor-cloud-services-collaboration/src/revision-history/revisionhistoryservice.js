/*
 *             Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x6af7a1 from'./../messagescompressor.js';import _0x5127ce from'./messages/revisionhistorygetrevisionmessage.js';import _0x3e383c from'./responses/revisionhistorygetrevisionresponse.js';import _0x40042d from'./messages/revisionhistoryupdaterevisionsmessage.js';import _0xfdde90 from'./responses/revisionhistoryupdaterevisionsresponse.js';import _0x22d020 from'./messages/revisionhistoryconnectmessage.js';import _0x58a769 from'./responses/revisionhistoryconnectresponse.js';import _0x5d8cee from'./messages/revisionhistoryreconnectmessage.js';import _0x215f3f from'../ckeditorcloudserviceserror.js';import _0x5a6627,{WEB_SOCKET_GATEWAY_STATES}from'../websocketgateway/websocketgateway.js';import _0x4be583 from'../errors/ServiceNotConnectedError.js';export const _SERVICE=0xc;class RevisionHistoryService extends/* #__PURE__ -- @preserve */
EmitterMixin(){['_documentId'];['_isConnected']=!0x1;['_wsGateway'];['_channel'];static ['_SERVICE']=0xc;constructor(_0x443c90){super(),this['_documentId']=_0x443c90;}get['isConnected'](){return this['_isConnected'];}['connect'](_0x4009bb){return this['_isConnected']?Promise['resolve']():this['_connect'](_0x4009bb,new _0x22d020(this['_documentId']));}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}['reconnect'](_0x12367a,_0x1e33e5){if(this['isConnected'])throw new _0x215f3f('Cannot\x20reconnect\x20to\x20already\x20connected\x20service.',_0x12367a);return this['_connect'](_0x12367a,new _0x5d8cee(this['_documentId'],_0x1e33e5));}async['updateRevisions'](_0x3057d0,_0x2bca9e){const _0x121962=_0x40042d['create']({'documentId':this['_documentId'],'requestId':_0x2bca9e,'revisions':_0x3057d0}),_0x26dcf9=await this['_sendRequest'](_0x40042d['TYPE'],_0x121962),{requestId:_0x470d11}=_0x6af7a1['decode'](_0x26dcf9,_0xfdde90);return _0x470d11;}async['getRevision'](_0x18899c){const _0x43456c=new _0x5127ce(this['_documentId'],_0x18899c),_0x156ff6=await this['_sendRequest'](_0x5127ce['TYPE'],_0x43456c);return _0x6af7a1['decode'](_0x156ff6,_0x3e383c)['toObject']();}async['_connect'](_0x12a377,_0x5aea67){if(_0x12a377['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x215f3f('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x12a377);this['_wsGateway']=_0x12a377,this['stopListening'](_0x12a377,'change:state');const _0x3e5ed3=await _0x12a377['_sendRequest'](0xc,_0x5aea67['constructor']['TYPE'],_0x6af7a1['encode'](_0x5aea67)),{channel:_0x1ff6bd,requestId:_0x4ecdbf,revisions:_0x569455}=_0x6af7a1['decode'](_0x3e5ed3,_0x58a769)['toObject']();return this['listenTo'](_0x12a377,'change:state',(_0x431119,_0x1c609f,_0x546e25)=>this['_onWsGatewayStateChange'](_0x546e25),{'priority':_0x5a6627['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x12a377,_0x1ff6bd),this['_isConnected']=!0x0,this['fire']('connected'),{'revisions':_0x569455,'requestId':_0x4ecdbf};}['_connectToChannel'](_0x2ffd7b,_0x2182f0){this['_channel']=_0x2ffd7b['_getChannel'](RevisionHistoryService['_SERVICE'],_0x2182f0),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x40042d['TYPE']),(_0x211a36,_0x1bbad5)=>{const {documentId:_0x205aec,requestId:_0x111063,revisions:_0x4c1446}=_0x6af7a1['decode'](_0x1bbad5,_0x40042d)['toObject']();this['fire']('revisionsUpdated',{'documentId':_0x205aec,'requestId':_0x111063,'revisionsData':_0x4c1446});});}['_onWsGatewayStateChange'](_0x5c97a3){_0x5c97a3===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x42366a,_0x143e0a){if(!this['_wsGateway']||!this['_isConnected'])throw new _0x4be583('Revision\x20History',this);return this['_wsGateway']['_sendRequest'](0xc,_0x42366a,_0x6af7a1['encode'](_0x143e0a));}}export default RevisionHistoryService;