/*
 *             Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x208ae6 from'./../messagescompressor.js';import _0x32b55a from'./messages/addsuggestionmessage.js';import _0x1235b9 from'./responses/addsuggestionresponse.js';import _0x3b8043 from'./messages/getsuggestionmessage.js';import _0x2abd32 from'./responses/getsuggestionresponse.js';import _0xdfe262 from'./messages/getallsuggestionsmessage.js';import _0x300753 from'./responses/getallsuggestionsresponse.js';import _0x738e37 from'./messages/updatesuggestionmessage.js';import _0x40c88e from'./messages/connectmessage.js';import _0x3c1860 from'./responses/connectresponse.js';import _0x229dae from'../ckeditorcloudserviceserror.js';import _0x123623,{WEB_SOCKET_GATEWAY_STATES}from'../websocketgateway/websocketgateway.js';import _0x2e1b1b from'../errors/ServiceNotConnectedError.js';import _0x499dea from'../ckeditorcloudservicesservererror.js';import _0x5d6cdc from'./messages/batchUpdateSuggestionsStateMessage.js';export const _SERVICE=0xa;class TrackChangesService extends/* #__PURE__ -- @preserve */
EmitterMixin(){['_documentId'];['_isConnected']=!0x1;['_wsGateway'];['_channel'];static ['_SERVICE']=0xa;constructor(_0x456339){super(),this['_documentId']=_0x456339;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x4bdd8c){if(this['_isConnected'])return;if(_0x4bdd8c['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x229dae('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x4bdd8c);const _0x46d945=new _0x40c88e(this['_documentId']);this['_wsGateway']=_0x4bdd8c,this['stopListening'](_0x4bdd8c,'change:state');const _0x49c257=await _0x4bdd8c['_sendRequest'](0xa,_0x40c88e['TYPE'],_0x208ae6['encode'](_0x46d945)),_0x5498d0=_0x208ae6['decode'](_0x49c257,_0x3c1860);return this['listenTo'](_0x4bdd8c,'change:state',(_0x40bc1f,_0x4af006,_0x472da6)=>this['_onWsGatewayStateChange'](_0x472da6),{'priority':_0x123623['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x4bdd8c,_0x5498d0['channel']),this['_isConnected']=!0x0,this['fire']('connected'),_0x5498d0['suggestions'];}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['add'](_0x2288a2,_0x52bd6a,_0x1a8b92,_0x4d8394=null,_0x1d22a1){const _0x191853=new _0x32b55a(_0x2288a2,this['_documentId'],_0x52bd6a,_0x1a8b92,_0x4d8394,_0x1d22a1),_0x3e359f=await this['_sendRequest'](_0x32b55a['TYPE'],_0x191853);return _0x208ae6['decode'](_0x3e359f,_0x1235b9);}async['get'](_0xba0d8a,_0x5b1661=0x1){const _0x9a1ff9=new _0x3b8043(_0xba0d8a,this['_documentId']);try{const _0x138b54=await this['_sendRequest'](_0x3b8043['TYPE'],_0x9a1ff9);return _0x208ae6['decode'](_0x138b54,_0x2abd32);}catch(_0x297d4a){if('CKEditorCloudServicesServerError'===_0x297d4a['name']&&'404'===_0x297d4a['code']&&_0x5b1661<0x5)return await(_0x49b154=0x64*_0x5b1661,new Promise(_0x30e785=>{setTimeout(_0x30e785,_0x49b154);})),this['get'](_0xba0d8a,_0x5b1661+0x1);if('CKEditorCloudServicesServerError'===_0x297d4a['name'])throw _0x297d4a;throw _0x499dea['fromPublicError'](_0x297d4a);}var _0x49b154;}async['getAll'](){const _0x29f2b0=new _0xdfe262(this['_documentId']),_0x579e2d=await this['_sendRequest'](_0xdfe262['TYPE'],_0x29f2b0),{suggestions:_0x293cc3}=_0x208ae6['decode'](_0x579e2d,_0x300753);return _0x293cc3;}async['update'](_0xe9e5c9,_0x411edd={}){const {hasComments:_0x534dbc,state:_0x3f7539,attributes:_0x36b559}=_0x411edd,_0x2106e2=void 0x0!==_0x534dbc,_0x215463=new _0x738e37(_0xe9e5c9,this['_documentId'],_0x534dbc,_0x2106e2,_0x3f7539,_0x36b559);await this['_sendRequest'](_0x738e37['TYPE'],_0x215463);}async['batchUpdateState'](_0x1a17c8){const _0x127968=new _0x5d6cdc(_0x1a17c8['ids'],this['_documentId'],_0x1a17c8['state']);await this['_sendRequest'](_0x5d6cdc['TYPE'],_0x127968);}['_connectToChannel'](_0x498998,_0x1e4070){this['_channel']=_0x498998['_getChannel'](TrackChangesService['_SERVICE'],_0x1e4070),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x738e37['TYPE']),(_0x39814d,_0x58910e)=>{const _0xe6f8d7=_0x208ae6['decode'](_0x58910e,_0x738e37);this['fire']('suggestionUpdated',_0xe6f8d7);});}['_onWsGatewayStateChange'](_0x4726d1){_0x4726d1===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x4b0760,_0x522bc2){if(!this['_wsGateway']||!this['_isConnected'])throw new _0x2e1b1b('Track\x20Changes',this);return this['_wsGateway']['_sendRequest'](0xa,_0x4b0760,_0x208ae6['encode'](_0x522bc2));}}export default TrackChangesService;