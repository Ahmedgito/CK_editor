/*
 *             Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x53c9b4 from'./../messagescompressor.js';import _0x14b047 from'./messages/addcommentmessage.js';import _0x2ca29c from'./responses/addcommentresponse.js';import _0x3fc9b7 from'./messages/connectmessage.js';import _0x247abf from'./responses/connectresponse.js';import _0x672851 from'./messages/removecommentmessage.js';import _0x55b337 from'./messages/removecommentthreadmessage.js';import _0xba67d3 from'./messages/updatecommentmessage.js';import _0x56e34e from'./messages/getcommentthreadmessage.js';import _0xec0354 from'./responses/getcommentthreadresponse.js';import _0xdfd1df from'./messages/getdocumentthreadsmessage.js';import _0x5cd938 from'./responses/getdocumentthreadsresponse.js';import _0x2db8b7,{WEB_SOCKET_GATEWAY_STATES}from'./../websocketgateway/websocketgateway.js';import _0x49d952 from'./../ckeditorcloudserviceserror.js';import _0x31eebe from'../sessions/sessions.js';import _0x27696d from'../errors/ServiceNotConnectedError.js';import _0x473850 from'../ckeditorcloudservicesservererror.js';import _0x387ab3 from'./responses/comment-threads/addcommentthreadresponse.js';import _0xa18ccb from'./messages/comment-threads/addcommentthreadmessage.js';import _0x276060 from'./messages/comment-threads/resolvecommentthreadmessage.js';import _0x174ae9 from'./messages/comment-threads/reopencommentthreadmessage.js';import _0x548a7b from'./messages/comment-threads/updatecommentthreadmessage.js';import _0x57f19c from'./responses/comment-threads/resolvecommentthreadresponse.js';export const _SERVICE=0x9;class CommentsService extends/* #__PURE__ -- @preserve */
EmitterMixin(){['_documentId'];['_isConnected']=!0x1;['_wsGateway'];['_channel'];['_connectedSessions'];static ['_SERVICE']=0x9;constructor(_0x52d444){super(),this['_documentId']=_0x52d444;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x67d0c){if(this['_isConnected'])return;if(_0x67d0c['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x49d952('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x67d0c);const _0x1737fb=new _0x3fc9b7(this['_documentId']);this['_wsGateway']=_0x67d0c,this['stopListening'](_0x67d0c,'change:state');const _0x1d7d7b=await _0x67d0c['_sendRequest'](0x9,_0x3fc9b7['TYPE'],_0x53c9b4['encode'](_0x1737fb)),{channel:_0x3b426c,threads:_0x266c95}=_0x53c9b4['decode'](_0x1d7d7b,_0x247abf);return this['listenTo'](_0x67d0c,'change:state',(_0x53330b,_0xe486d8,_0x386b78)=>this['_onWsGatewayStateChange'](_0x386b78),{'priority':_0x2db8b7['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x67d0c,_0x3b426c),this['_isConnected']=!0x0,this['fire']('connected'),_0x266c95;}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['_connectedSessions']&&(this['_connectedSessions']['disconnect'](),this['_connectedSessions']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['addComment'](_0x10e636,_0x36521a,_0x5e9c69,_0x347f32){const _0xb3caa=new _0x14b047(this['_documentId'],_0x10e636,_0x5e9c69,_0x36521a,void 0x0,void 0x0,_0x347f32),_0x47ac09=await this['_sendRequest'](_0x14b047['TYPE'],_0xb3caa);return _0x53c9b4['decode'](_0x47ac09,_0x2ca29c);}async['updateComment'](_0xd765b1,_0x417214,_0x5418d4,_0x4ef19c){const _0x4d1bce=void 0x0!==_0x4ef19c,_0x58b80b=new _0xba67d3(this['_documentId'],_0xd765b1,_0x417214,_0x5418d4,_0x4ef19c,_0x4d1bce);await this['_sendRequest'](_0xba67d3['TYPE'],_0x58b80b);}async['removeComment'](_0x43da23,_0x1de01f){const _0x2a71fd=new _0x672851(this['_documentId'],_0x43da23,_0x1de01f);await this['_sendRequest'](_0x672851['TYPE'],_0x2a71fd);}async['removeCommentThread'](_0x56ffc0){const _0x33eaf2=new _0x55b337(this['_documentId'],_0x56ffc0);await this['_sendRequest'](_0x55b337['TYPE'],_0x33eaf2);}async['addCommentThread'](_0x5ec7d2){const _0x22db1b=new _0xa18ccb(this['_documentId'],_0x5ec7d2['commentThreadId'],_0x5ec7d2['comments']?.['map'](_0x297929=>({..._0x297929,'documentId':this['_documentId'],'commentThreadId':_0x5ec7d2['commentThreadId']})),_0x5ec7d2['context'],_0x5ec7d2['resolvedBy'],_0x5ec7d2['createdAt'],_0x5ec7d2['resolvedAt'],_0x5ec7d2['deletedAt'],_0x5ec7d2['attributes']),_0x24795a=await this['_sendRequest'](_0xa18ccb['TYPE'],_0x22db1b);return _0x53c9b4['decode'](_0x24795a,_0x387ab3);}async['resolveCommentThread'](_0x332637){const _0x514dac=new _0x276060(_0x332637,this['_documentId']),_0x1de7c8=await this['_sendRequest'](_0x276060['TYPE'],_0x514dac);return _0x53c9b4['decode'](_0x1de7c8,_0x57f19c);}async['reopenCommentThread'](_0x160dec){const _0x2e9351=new _0x174ae9(_0x160dec,this['_documentId']);await this['_sendRequest'](_0x174ae9['TYPE'],_0x2e9351);}async['updateCommentThread'](_0x1ede78){const _0x144f9e=new _0x548a7b(_0x1ede78['commentThreadId'],this['_documentId'],_0x1ede78['context'],_0x1ede78['attributes'],_0x1ede78['unlinkedAt']);await this['_sendRequest'](_0x548a7b['TYPE'],_0x144f9e);}async['getCommentThread'](_0x3b9aad,_0x13029b=0x1){const _0x140a22=new _0x56e34e(_0x3b9aad,this['_documentId']);try{const _0x19ed21=await this['_sendRequest'](_0x56e34e['TYPE'],_0x140a22),_0x2a82ec=_0x53c9b4['decode'](_0x19ed21,_0xec0354);return{'commentThreadId':_0x2a82ec['commentThreadId'],'comments':_0x2a82ec['comments'],'attributes':_0x2a82ec['attributes'],'context':_0x2a82ec['context'],'resolvedAt':_0x2a82ec['resolvedAt'],'resolvedBy':_0x2a82ec['resolvedBy'],'deletedAt':_0x2a82ec['deletedAt'],'unlinkedAt':_0x2a82ec['unlinkedAt']};}catch(_0x40846a){if('CKEditorCloudServicesServerError'===_0x40846a['name']&&'404'===_0x40846a['code']&&_0x13029b<0x5)return await(_0x3c4c1=0x64*_0x13029b,new Promise(_0x4755c0=>{setTimeout(_0x4755c0,_0x3c4c1);})),this['getCommentThread'](_0x3b9aad,_0x13029b+0x1);if('CKEditorCloudServicesServerError'===_0x40846a['name'])throw _0x40846a;throw _0x473850['fromPublicError'](_0x40846a);}var _0x3c4c1;}async['getDocumentThreads'](){const _0x349636=new _0xdfd1df(this['_documentId']),_0x4405e4=await this['_sendRequest'](_0xdfd1df['TYPE'],_0x349636),{threads:_0x1b1f0d}=_0x53c9b4['decode'](_0x4405e4,_0x5cd938);return{'threads':_0x1b1f0d};}async['getConnectedSessions'](){if(!this['_isConnected'])throw new _0x27696d('Comments',this);return this['_connectedSessions']||(this['_connectedSessions']=await _0x31eebe['getConnectedSessions'](this['_wsGateway'],this['_documentId'],0x9)),this['_connectedSessions'];}['_connectToChannel'](_0x3a904a,_0x1141a9){this['_channel']=_0x3a904a['_getChannel'](CommentsService['_SERVICE'],_0x1141a9),this['_channel']&&(this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x14b047['TYPE']),(_0x1ea542,_0x15fc98)=>{const _0x1b5a5f=_0x53c9b4['decode'](_0x15fc98,_0x14b047);this['fire']('commentAdded',_0x1b5a5f);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x672851['TYPE']),(_0x5251ef,_0x41ed2c)=>{const _0x35d951=_0x53c9b4['decode'](_0x41ed2c,_0x672851);this['fire']('commentRemoved',_0x35d951);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0xba67d3['TYPE']),(_0x34dc7e,_0xb1b491)=>{const _0x1e881b=_0x53c9b4['decode'](_0xb1b491,_0xba67d3);this['fire']('commentUpdated',_0x1e881b);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x55b337['TYPE']),(_0x1a11f6,_0x4d3d51)=>{const _0x4d5aed=_0x53c9b4['decode'](_0x4d3d51,_0x55b337);this['fire']('commentThreadRemoved',_0x4d5aed);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0xa18ccb['TYPE']),(_0x5124d9,_0x1962f8)=>{const _0x2920d7=_0x53c9b4['decode'](_0x1962f8,_0xa18ccb);this['fire']('commentThreadAdded',_0x2920d7);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x548a7b['TYPE']),(_0x1a40cb,_0x43fa4e)=>{const _0x44aba3=_0x53c9b4['decode'](_0x43fa4e,_0x548a7b);this['fire']('commentThreadUpdated',_0x44aba3);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x276060['TYPE']),(_0x108137,_0x53199b)=>{const _0x5e4f75=_0x53c9b4['decode'](_0x53199b,_0x276060);this['fire']('commentThreadResolved',_0x5e4f75);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x174ae9['TYPE']),(_0x1d9ece,_0x3b7e72)=>{const _0x5b0e54=_0x53c9b4['decode'](_0x3b7e72,_0x174ae9);this['fire']('commentThreadReopened',_0x5b0e54);}));}['_onWsGatewayStateChange'](_0x486279){_0x486279===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x3df959,_0x3b72e8){if(!this['_wsGateway']||!this['_isConnected'])throw new _0x27696d('Comments',this);return this['_wsGateway']['_sendRequest'](0x9,_0x3df959,_0x53c9b4['encode'](_0x3b72e8));}}export default CommentsService;