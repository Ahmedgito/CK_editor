/*
 *             Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Command as _0x42c742,Plugin as _0x25c967}from'@ckeditor/ckeditor5-core/dist/index.js';import{ButtonView as _0x840f9b,MenuBarMenuListItemButtonView as _0x2028fe,SpinnerView as _0x37c113,Notification as _0x18b0d5}from'@ckeditor/ckeditor5-ui/dist/index.js';import{logWarning as _0x29089e,collectStylesheets as _0x4b19a2}from'@ckeditor/ckeditor5-utils/dist/index.js';import{IconExportWord as _0xdda0a9}from'@ckeditor/ckeditor5-icons/dist/index.js';function d(_0x5b0ca8,_0x22fad2={}){const _0x2c2d91=_0x5b0ca8['plugins']['has']('Users'),_0x199c40=_0x5b0ca8['plugins']['has']('CommentsRepository'),_0x5ae49b=_0x5b0ca8['plugins']['has']('TrackChanges'),_0x1dd4f0=_0x22fad2;if(_0x2c2d91&&_0x199c40){const _0x5550c1=function(_0x1e64f3){const _0x29d575={};if(!_0x1e64f3['length'])return _0x29d575;for(const _0x577a2b of _0x1e64f3)_0x577a2b['comments']['map'](_0x15f253=>{void 0x0===_0x29d575[_0x577a2b['id']]&&(_0x29d575[_0x577a2b['id']]=[]),_0x29d575[_0x577a2b['id']]['push']({'author':_0x15f253['author']['name'],'content':_0x15f253['content'],'created':_0x15f253['createdAt'],'is_resolved':_0x577a2b['isResolved']});});return _0x29d575;}(_0x5b0ca8['plugins']['get']('CommentsRepository')['getCommentThreads']({'skipNotAttached':!0x0,'skipEmpty':!0x0}));Object['keys'](_0x5550c1)['length']&&(_0x1dd4f0['comments']=_0x5550c1);}if(_0x2c2d91&&_0x5ae49b){const _0x725057=_0x5b0ca8['plugins']['get']('TrackChanges'),_0x2cb820=_0x5b0ca8['plugins']['get']('Users'),_0x10a513=function(_0x7b358c,_0x4e2e1a){const _0xac8d0f={};if(!_0x7b358c['length']||!_0x4e2e1a['length'])return _0xac8d0f;for(const {id:_0x130b21,createdAt:_0x500e48,authorId:_0x391d54,attributes:_0x1d629e}of _0x7b358c){const _0x22bdb1=_0x1d629e&&_0x1d629e['@external'],_0x2bb0e1=_0x22bdb1?_0x22bdb1['authorName']:_0x4e2e1a['get'](_0x391d54)['name'];_0xac8d0f[_0x130b21]={'author':_0x2bb0e1,'created':_0x500e48};}return _0xac8d0f;}(_0x725057['getSuggestions']({'toJSON':!0x0}),_0x2cb820['users']);Object['keys'](_0x10a513)['length']&&(_0x1dd4f0['suggestions']=_0x10a513);}return(_0x1dd4f0['suggestions']||_0x1dd4f0['comments'])&&(_0x1dd4f0['timezone']=new Intl['DateTimeFormat']()['resolvedOptions']()['timeZone']),_0x1dd4f0;}function a(_0x33cde7,_0x509551={}){const _0xb64507=_0x33cde7['plugins']['has']('Users'),_0x55cc9d=_0x33cde7['plugins']['has']('CommentsRepository'),_0x17f0d2=_0x33cde7['plugins']['has']('TrackChanges'),_0x133854=_0x33cde7['plugins']['has']('MergeFields'),_0x43e46a=_0x33cde7['locale']['contentLanguage'],_0x435919=_0x509551,_0x5ecc98={};if(_0x435919['document']=_0x435919['document']||{},_0x435919['document']['language']=_0x435919['document']['language']||_0x43e46a,_0xb64507&&_0x55cc9d){const _0x415c37=function(_0x15a1cb){const _0x5b58ea=[];if(!_0x15a1cb['length'])return _0x5b58ea;for(const _0x3dbfc6 of _0x15a1cb){const _0x37ddf8=_0x3dbfc6['comments']['map'](_0x505a77=>({'author':_0x505a77['author']['name'],'content':_0x505a77['content'],'created_at':_0x505a77['createdAt']}));_0x5b58ea['push']({'thread_id':_0x3dbfc6['id'],'is_resolved':_0x3dbfc6['isResolved'],'comments':_0x37ddf8});}return _0x5b58ea;}(_0x33cde7['plugins']['get']('CommentsRepository')['getCommentThreads']({'skipNotAttached':!0x0,'skipEmpty':!0x0}));_0x415c37['length']&&(_0x5ecc98['comment_threads']=_0x415c37);}if(_0xb64507&&_0x17f0d2){const _0x39f6ff=_0x33cde7['plugins']['get']('TrackChanges'),_0x961380=_0x33cde7['plugins']['get']('Users'),_0x4dfafc=function(_0xa7b0da,_0x51676a){if(!_0xa7b0da['length']||!_0x51676a['length'])return[];return _0xa7b0da['map'](({id:_0x7e9553,createdAt:_0x145fee,authorId:_0x9638fd,attributes:_0x45b3ab})=>{const _0x53b08f=_0x45b3ab&&_0x45b3ab['@external'];return{'id':_0x7e9553,'author':_0x53b08f?_0x53b08f['authorName']:_0x51676a['get'](_0x9638fd)['name'],'created_at':_0x145fee};});}(_0x39f6ff['getSuggestions']({'toJSON':!0x0}),_0x961380['users']);_0x4dfafc['length']&&(_0x5ecc98['suggestions']=_0x4dfafc);}if(_0x133854){const _0x5734b9=_0x33cde7['plugins']['get']('MergeFieldsEditing'),_0x34cdc=_0x5734b9['previewMode'],{prefix:_0x2715d1,suffix:_0xe2b310}=_0x33cde7['config']['get']('mergeFields');if(_0x435919['merge_fields']={'prefix':_0x2715d1,'suffix':_0xe2b310},'$labels'!==_0x34cdc){_0x435919['merge_fields']['data']={};const _0x5d633='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP88B8AAuUB8e2ujYwAAAAASUVORK5CYII=',_0x42a43a='$defaultValues'===_0x34cdc?_0x5734b9['getDefaultValues']():_0x5734b9['getDataSetValues'](_0x34cdc,!0x0);for(const _0x49d29b of Object['entries'](_0x42a43a)){const [_0x4dca8c,_0x2b53ae]=_0x49d29b;'image'===_0x5734b9['getMergeFieldType'](_0x4dca8c)?_0x435919['merge_fields']['data'][_0x4dca8c]=null!==_0x2b53ae?_0x2b53ae:_0x5d633:_0x435919['merge_fields']['data'][_0x4dca8c]=null!==_0x2b53ae?_0x2b53ae:_0x5734b9['getLabel'](_0x4dca8c)||_0x4dca8c;}}}return(_0x5ecc98['comment_threads']||_0x5ecc98['suggestions'])&&(_0x435919['timezone']=new Intl['DateTimeFormat']()['resolvedOptions']()['timeZone'],_0x435919['collaboration_features']=_0x5ecc98),_0x435919;}function m(_0x143025,_0x40d890){const t=_0x143025['t'];switch(_0x40d890){case'Export\x20to\x20Word':return t('Export\x20to\x20Word');case'An\x20error\x20occurred\x20while\x20generating\x20the\x20Word\x20file.':return t('An\x20error\x20occurred\x20while\x20generating\x20the\x20Word\x20file.');case'Word\x20document\x20export\x20started':return t('Word\x20document\x20export\x20started');case'Word\x20document\x20export\x20failed':return t('Word\x20document\x20export\x20failed');case'Word\x20document\x20export\x20successful':return t('Word\x20document\x20export\x20successful');case'Exporting\x20Word\x20document':return t('Exporting\x20Word\x20document');default:return _0x40d890;}}const p=['orientation','margin_top','margin_right','margin_bottom','margin_left','format','header','footer','comments','suggestions'];class i extends _0x42c742{constructor(_0x7fd404){super(_0x7fd404),this['set']('isBusy',!0x1),this['affectsData']=!0x1;}['refresh'](){this['isEnabled']=!this['isBusy'],this['value']=this['isBusy']?'pending':void 0x0;}['execute'](_0x4bf02a={}){const _0x247d45=this['editor'],_0x475816=_0x4bf02a['version']||0x2,_0x4ef24c=0x1===_0x475816,_0x25cc70=_0x4bf02a['converterUrl']||(_0x4ef24c?'https://docx-converter.cke-cs.com/v1/convert':'https://docx-converter.cke-cs.com/v2/convert/html-docx'),_0x54b00f=_0x4bf02a['converterOptions']||{},_0x45f939=_0x247d45['plugins']['get']('ExportWord'),_0x21d8cb=_0x4bf02a['token']||_0x45f939['_token'],_0x38968c=!0x0===_0x54b00f['auto_pagination'],_0x4d14b2=_0x4bf02a['dataCallback']||(_0x517a92=>_0x517a92['data']['get']({'pagination':_0x38968c}));return 0x2===_0x475816&&function(_0x49e91b){for(const _0x4ed6ed of p)if(void 0x0!==_0x49e91b[_0x4ed6ed])return!0x0;return!0x1;}(_0x54b00f)&&_0x29089e('export-word-v1-api-is-deprecated'),this['isBusy']=!0x0,this['refresh'](),_0x4b19a2(_0x4bf02a['stylesheets']||['EDITOR_STYLES'])['then'](async _0x90aab0=>{_0x247d45['ui']['ariaLiveAnnouncer']['announce'](m(_0x247d45['locale'],'Word\x20document\x20export\x20started'));const _0xca684c=await _0x4d14b2(_0x247d45),_0x18b884={'html':'<div\x20class=\x22ck-content\x22\x20dir=\x22'+_0x247d45['locale']['contentLanguageDirection']+'\x22>'+_0xca684c+'</div>','css':_0x90aab0,[_0x4ef24c?'options':'config']:{..._0x54b00f,..._0x4ef24c?d(_0x247d45,_0x54b00f):a(_0x247d45,_0x54b00f)}},_0x1f0c92={'method':'POST','headers':{'Content-Type':'application/json','Accept':'application/docx',..._0x21d8cb?{'Authorization':_0x21d8cb['value']}:null},'body':JSON['stringify'](_0x18b884)};return window['fetch'](_0x25cc70,_0x1f0c92)['then'](_0x2b7fea=>{if(0xc8!==_0x2b7fea['status'])throw _0x2b7fea;return _0x2b7fea['blob']();})['then'](_0x150402=>{_0x247d45['ui']['ariaLiveAnnouncer']['announce'](m(_0x247d45['locale'],'Word\x20document\x20export\x20successful'));const _0x322693='function'==typeof _0x4bf02a['fileName']?_0x4bf02a['fileName']():_0x4bf02a['fileName'];this['_downloadFile'](_0x150402,_0x322693||'document.docx');});})['catch'](_0xa35b1f=>{const _0x26405e=_0x247d45['plugins']['get']('Notification');throw _0x247d45['ui']['ariaLiveAnnouncer']['announce'](m(_0x247d45['locale'],'Word\x20document\x20export\x20failed'),{'politeness':'assertive'}),_0x26405e['showWarning'](m(_0x247d45['locale'],'An\x20error\x20occurred\x20while\x20generating\x20the\x20Word\x20file.')),_0xa35b1f;})['finally'](()=>{this['isBusy']=!0x1,this['refresh']();});}['_downloadFile'](_0x122613,_0x1ca56b){const _0x5387b0=document['createElement']('a');_0x5387b0['href']=window['URL']['createObjectURL'](_0x122613),_0x5387b0['download']=_0x1ca56b,_0x5387b0['click'](),_0x5387b0['remove']();}}class e extends _0x25c967{static get['pluginName'](){return'ExportWordUI';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}['init'](){const _0x5cffe8=this['editor'];_0x5cffe8['ui']['componentFactory']['add']('exportWord',()=>{const _0x518edc=_0x5cffe8['commands']['get']('exportWord'),_0x56349d=this['_createButton'](_0x840f9b);return _0x56349d['set']({'tooltip':!0x0}),_0x56349d['bind']('isOn')['to'](_0x518edc,'isBusy'),_0x56349d;}),_0x5cffe8['ui']['componentFactory']['add']('menuBar:exportWord',()=>this['_createButton'](_0x2028fe));}['_createButton'](_0x3a4587){const _0x7af7e9=this['editor'],_0x511401=_0x7af7e9['config']['get']('exportWord')||{},_0x5ce607=_0x7af7e9['commands']['get']('exportWord'),_0x1dd87b=new _0x3a4587(_0x7af7e9['locale']),_0x17e4fe=new _0x37c113();return _0x1dd87b['children']['add'](_0x17e4fe),_0x17e4fe['bind']('isVisible')['to'](_0x5ce607,'isBusy'),_0x1dd87b['iconView']['bind']('isVisible')['to'](_0x5ce607,'isBusy',_0xccb3ac=>!_0xccb3ac),_0x1dd87b['set']({'icon':_0xdda0a9}),_0x1dd87b['bind']('isEnabled')['to'](_0x5ce607,'isEnabled'),_0x1dd87b['bind']('label')['to'](_0x5ce607,'isBusy',_0x4b4d5a=>m(_0x7af7e9['locale'],_0x4b4d5a?'Exporting\x20Word\x20document':'Export\x20to\x20Word')),this['listenTo'](_0x1dd87b,'execute',()=>{_0x7af7e9['execute']('exportWord',_0x511401),_0x7af7e9['editing']['view']['focus']();}),_0x1dd87b;}}class f extends _0x25c967{['_token'];static get['pluginName'](){return'ExportWord';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}static get['requires'](){return['CloudServices',_0x18b0d5,e];}['init'](){const _0x10c441=this['editor'],_0x5470f8=_0x10c441['config']['get']('exportWord')||{};_0x10c441['commands']['add']('exportWord',new i(_0x10c441));const _0x20c460=_0x10c441['plugins']['get']('CloudServices');!0x1===_0x5470f8['tokenUrl']?this['_token']=null:_0x5470f8['tokenUrl']?_0x20c460['registerTokenUrl'](_0x5470f8['tokenUrl'])['then'](_0x493d4f=>{this['_token']=_0x493d4f;}):this['_token']=_0x20c460['token'];}}export{f as ExportWord,i as ExportWordCommand};