/*
 *             Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x30714a=_0x2177;function _0x2177(_0x163bc0,_0x23bc5e){const _0x2f7560=_0x2f75();return _0x2177=function(_0x217732,_0xc1b20f){_0x217732=_0x217732-0x161;let _0x3538a5=_0x2f7560[_0x217732];return _0x3538a5;},_0x2177(_0x163bc0,_0x23bc5e);}(function(_0x3fcdf5,_0x1983b7){const _0x435c2e=_0x2177,_0xef7318=_0x3fcdf5();while(!![]){try{const _0x5f1053=-parseInt(_0x435c2e(0x1b7))/0x1+-parseInt(_0x435c2e(0x1ae))/0x2*(parseInt(_0x435c2e(0x162))/0x3)+-parseInt(_0x435c2e(0x1c6))/0x4*(parseInt(_0x435c2e(0x19f))/0x5)+-parseInt(_0x435c2e(0x1bc))/0x6*(parseInt(_0x435c2e(0x1a9))/0x7)+-parseInt(_0x435c2e(0x16c))/0x8*(parseInt(_0x435c2e(0x167))/0x9)+parseInt(_0x435c2e(0x1ac))/0xa*(-parseInt(_0x435c2e(0x18d))/0xb)+parseInt(_0x435c2e(0x192))/0xc*(parseInt(_0x435c2e(0x185))/0xd);if(_0x5f1053===_0x1983b7)break;else _0xef7318['push'](_0xef7318['shift']());}catch(_0x36ba09){_0xef7318['push'](_0xef7318['shift']());}}}(_0x2f75,0x21087));import{ObservableMixin as _0x4bfb19}from'ckeditor5/src/utils.js';import{AIRequestError as _0xa73b73}from'../adapters/aiadapter.js';import{Matcher as _0x24b3fc,ViewUpcastWriter as _0x4b0312}from'ckeditor5/src/engine.js';function _0x2f75(){const _0xbae5fc=['get','currentContext','value','editing','remove','catch','20130GecAzE','initialContext','listenTo','once','clear','push','toView','_isH1TagSupportEnabled','innerHTML','isProcessing','7LNDHHX','set:currentContext','textAdapter','42690yGhzGM','viewToDom','127154vfQFZk','mainAction','length','substring','set','body','prompt','ai.assistant.preserveComments','then','52520fGMabY','div','view','startsWith','```','1503756oPJfxK','previousLabel','stopListening','```html','updateView','submitPrompt','ELEMENT_NODE','setContentOf','custom','reset','180ivmyJv','currentResponse','abort','3TlzeOf','text/html','element','processor','htmlProcessor','1782vzKdIV','markers','handleError','stringify','_parseAndNormalizeContent','5072bqhCpE','trim','destroy','endsWith','match','previousContext','from','_stripMarkdownSyntax','_sanitizeHTML','childNodes','createElement','_normalizeResponseHeadings','nodeType','finishProcessing','_domParser','reverse','querySelector','rename','startProcessing','makeRequest','previousActionId','stopProcessing','render','exec','config','2535VExUuw','_sanitizationContainer','isRendered','message','finally','data','domConverter','serializeToString','33zwMAEG','parseFromString','<h1></h1>','_handleQuery','toModel','50556RihxgX','previousQuery','tryAgainEvent','document','editor','name','_xmlSerializer'];_0x2f75=function(){return _0xbae5fc;};return _0x2f75();}const hs=new RegExp(/^(.*?)<[a-zA-Z][a-zA-Z0-9_\-.]*[ >]/,'is');export class AIAssistantController extends/* #__PURE__ -- @preserve */
_0x4bfb19(){[_0x30714a(0x196)];[_0x30714a(0x1ab)];[_0x30714a(0x1b9)];[_0x30714a(0x186)];[_0x30714a(0x17a)];[_0x30714a(0x198)];constructor(_0x4c356b,_0x113932,_0x994af6){const _0x18a00c=_0x30714a;super(),this[_0x18a00c(0x196)]=_0x4c356b,this[_0x18a00c(0x1ab)]=_0x113932,this[_0x18a00c(0x186)]=document[_0x18a00c(0x176)](_0x18a00c(0x1b8)),this[_0x18a00c(0x17a)]=new DOMParser(),this[_0x18a00c(0x198)]=new XMLSerializer(),this[_0x18a00c(0x1b9)]=_0x994af6,this[_0x18a00c(0x1b2)]({'initialContext':'','currentContext':'','currentResponse':'','previousContext':void 0x0,'previousQuery':void 0x0,'previousLabel':void 0x0,'isProcessing':!0x1}),this['on'](_0x18a00c(0x1aa),(_0x2f9323,_0x28ccfe,_0x3d3123)=>{const _0x738fc=_0x18a00c;this[_0x738fc(0x1b9)][_0x738fc(0x19b)]=this[_0x738fc(0x174)](_0x3d3123);}),this[_0x18a00c(0x1a1)](this[_0x18a00c(0x1b9)],_0x18a00c(0x1c1),(_0x464979,_0x3c23c0)=>{const _0x1b2c5d=_0x18a00c,_0x434890=this[_0x1b2c5d(0x19a)]||this[_0x1b2c5d(0x1a0)];this[_0x1b2c5d(0x190)](_0x3c23c0,_0x434890,_0x1b2c5d(0x1c4));}),this[_0x18a00c(0x1a1)](this[_0x18a00c(0x1b9)],_0x18a00c(0x194),()=>{const _0x2d04de=_0x18a00c;this[_0x2d04de(0x1b9)][_0x2d04de(0x1b4)]=this[_0x2d04de(0x1bd)],this[_0x2d04de(0x190)](this[_0x2d04de(0x193)],this[_0x2d04de(0x171)],this[_0x2d04de(0x180)],this[_0x2d04de(0x1bd)]);}),this[_0x18a00c(0x1a1)](this[_0x18a00c(0x1b9)],_0x18a00c(0x181),()=>{const _0x30c6a1=_0x18a00c;this[_0x30c6a1(0x181)]();});}[_0x30714a(0x16e)](){const _0x1d0dd1=_0x30714a;this[_0x1d0dd1(0x1be)]();}async[_0x30714a(0x1c0)]({actionId:_0x395b41,query:_0x3749d2,htmlContent:_0x31e78b,label:_0x31b523,mainActionLabel:_0x5d250f}){const _0x4325ed=_0x30714a;this[_0x4325ed(0x1b9)][_0x4325ed(0x1b4)]=_0x31b523,this[_0x4325ed(0x1b9)][_0x4325ed(0x1af)]=_0x5d250f,this[_0x4325ed(0x1a0)]=_0x31e78b,_0x3749d2&&(this[_0x4325ed(0x1b9)][_0x4325ed(0x187)]?this[_0x4325ed(0x190)](_0x3749d2,_0x31e78b,_0x395b41,_0x31b523):this[_0x4325ed(0x1b9)][_0x4325ed(0x1a2)](_0x4325ed(0x182),()=>{const _0xc1626f=_0x4325ed;this[_0xc1626f(0x190)](_0x3749d2,_0x31e78b,_0x395b41,_0x31b523);}));}[_0x30714a(0x181)](){const _0x195e52=_0x30714a;this[_0x195e52(0x1a8)]&&(this[_0x195e52(0x1a8)]=!0x1,this[_0x195e52(0x1b9)][_0x195e52(0x179)](),this[_0x195e52(0x1ab)][_0x195e52(0x161)]());}[_0x30714a(0x1c5)](){const _0x247043=_0x30714a;this[_0x247043(0x1a0)]='',this[_0x247043(0x19a)]='',this[_0x247043(0x1c7)]='',this[_0x247043(0x171)]='',this[_0x247043(0x193)]='',this[_0x247043(0x1bd)]='',this[_0x247043(0x180)]=void 0x0,this[_0x247043(0x1b9)][_0x247043(0x1c5)](),this[_0x247043(0x181)]();}async[_0x30714a(0x190)](_0x411c94,_0x465935,_0xa12568,_0x54b5d7){const _0x42234c=_0x30714a;return this[_0x42234c(0x1a8)]=!0x0,this[_0x42234c(0x1b9)][_0x42234c(0x17e)](),this[_0x42234c(0x171)]=_0x465935,this[_0x42234c(0x193)]=_0x411c94,this[_0x42234c(0x1bd)]=_0x54b5d7||_0x411c94,this[_0x42234c(0x180)]=_0xa12568,new Promise(_0x25a3ec=>{const _0x2c9afe=_0x42234c;this[_0x2c9afe(0x1ab)][_0x2c9afe(0x17f)]({'query':_0x411c94,'context':_0x465935,'onData':_0x42b664=>{const _0x7fbf20=_0x2c9afe;this[_0x7fbf20(0x1c7)]=_0x42b664,this[_0x7fbf20(0x19a)]=this[_0x7fbf20(0x16b)](this[_0x7fbf20(0x1c7)]);},'actionId':_0xa12568})[_0x2c9afe(0x1b6)](()=>{const _0x74dc6b=_0x2c9afe;!this[_0x74dc6b(0x19a)]&&this[_0x74dc6b(0x1c7)]&&(this[_0x74dc6b(0x19a)]=this[_0x74dc6b(0x16b)](this[_0x74dc6b(0x1c7)],!0x0));})[_0x2c9afe(0x19e)](_0x2980f3=>{const _0x1b837b=_0x2c9afe;_0x2980f3 instanceof _0xa73b73?this[_0x1b837b(0x1b9)][_0x1b837b(0x169)](_0x2980f3[_0x1b837b(0x188)]):this[_0x1b837b(0x1b9)][_0x1b837b(0x169)](),_0x25a3ec();})[_0x2c9afe(0x189)](()=>{const _0xb6bda=_0x2c9afe;this[_0xb6bda(0x181)](),_0x25a3ec();});});}[_0x30714a(0x16b)](_0x29a3e8,_0x211319=!0x1){const _0x1e23c5=_0x30714a,_0x5ebb8b=hs[_0x1e23c5(0x183)](_0x29a3e8);_0x29a3e8=_0x5ebb8b?_0x29a3e8[_0x1e23c5(0x1b1)](_0x5ebb8b[0x1][_0x1e23c5(0x1b0)]):_0x29a3e8[_0x1e23c5(0x1b0)]<0x64&&!_0x211319?'':this[_0x1e23c5(0x173)](_0x29a3e8);const _0x194a23=this[_0x1e23c5(0x17a)][_0x1e23c5(0x18e)](_0x29a3e8,_0x1e23c5(0x163));if(_0x5ebb8b){const _0x406e03=Array[_0x1e23c5(0x172)](_0x194a23[_0x1e23c5(0x1b3)][_0x1e23c5(0x175)]);_0x406e03[_0x1e23c5(0x17b)]();for(const _0x57578 of _0x406e03){if(_0x57578[_0x1e23c5(0x178)]==Node[_0x1e23c5(0x1c2)])break;_0x57578[_0x1e23c5(0x19d)]();}}const _0x2b8d9e=this[_0x1e23c5(0x196)][_0x1e23c5(0x18a)][_0x1e23c5(0x165)][_0x1e23c5(0x1a5)](this[_0x1e23c5(0x198)][_0x1e23c5(0x18c)](_0x194a23[_0x1e23c5(0x1b3)]));this[_0x1e23c5(0x1a6)]()||this[_0x1e23c5(0x177)](_0x2b8d9e);const _0x2f92a7=this[_0x1e23c5(0x196)][_0x1e23c5(0x184)][_0x1e23c5(0x199)](_0x1e23c5(0x1b5)),_0x47b799=this[_0x1e23c5(0x196)][_0x1e23c5(0x18a)][_0x1e23c5(0x191)](_0x2b8d9e);return _0x2f92a7||_0x47b799[_0x1e23c5(0x168)][_0x1e23c5(0x1a3)](),this[_0x1e23c5(0x196)][_0x1e23c5(0x18a)][_0x1e23c5(0x16a)](_0x47b799);}[_0x30714a(0x177)](_0x583c83){const _0x3fa31f=_0x30714a,_0x6077f4=new _0x4b0312(this[_0x3fa31f(0x196)][_0x3fa31f(0x19c)][_0x3fa31f(0x1b9)][_0x3fa31f(0x195)]),_0x8f2bb7=new _0x24b3fc({'name':/^h[1-5]$/}),_0x25471b=[];let _0x2c6a13=!0x1;for(const _0x35b638 of _0x583c83)_0x35b638['is'](_0x3fa31f(0x164))&&_0x8f2bb7[_0x3fa31f(0x170)](_0x35b638)&&(_0x25471b[_0x3fa31f(0x1a4)](_0x35b638),'h1'==_0x35b638[_0x3fa31f(0x197)]&&(_0x2c6a13=!0x0));if(_0x2c6a13){for(const _0x289870 of _0x25471b)_0x6077f4[_0x3fa31f(0x17d)]('h'+(parseInt(_0x289870[_0x3fa31f(0x197)][0x1])+0x1),_0x289870);}}[_0x30714a(0x1a6)](){const _0x3ae17b=_0x30714a,{data:_0x1eac2f,editing:_0x4529dd}=this[_0x3ae17b(0x196)],_0x5553b9=_0x1eac2f[_0x3ae17b(0x166)][_0x3ae17b(0x1a5)](_0x3ae17b(0x18f)),_0x526f37=_0x1eac2f[_0x3ae17b(0x1a5)](_0x1eac2f[_0x3ae17b(0x191)](_0x5553b9));return!!_0x4529dd[_0x3ae17b(0x1b9)][_0x3ae17b(0x18b)][_0x3ae17b(0x1ad)](_0x526f37)[_0x3ae17b(0x17c)]('h1');}[_0x30714a(0x174)](_0x2b62f4){const _0x61a04f=_0x30714a;return this[_0x61a04f(0x196)][_0x61a04f(0x19c)][_0x61a04f(0x1b9)][_0x61a04f(0x18b)][_0x61a04f(0x1c3)](this[_0x61a04f(0x186)],_0x2b62f4),this[_0x61a04f(0x186)][_0x61a04f(0x1a7)];}[_0x30714a(0x173)](_0x4ac18b){const _0x19b6ca=_0x30714a,_0x16f1b9=_0x4ac18b[_0x19b6ca(0x16d)]();return _0x16f1b9[_0x19b6ca(0x1ba)](_0x19b6ca(0x1bf))?_0x16f1b9[_0x19b6ca(0x16f)](_0x19b6ca(0x1bb))?_0x16f1b9[_0x19b6ca(0x1b1)](0x7,_0x16f1b9[_0x19b6ca(0x1b0)]-0x3):_0x16f1b9[_0x19b6ca(0x1b1)](0x7):_0x4ac18b;}}