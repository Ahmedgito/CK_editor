/*
 *             Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x5221e4,Command as _0x1b08f6}from'@ckeditor/ckeditor5-core/dist/index.js';import{IconImportWord as _0x21e6a6}from'@ckeditor/ckeditor5-icons/dist/index.js';import{FileDialogButtonView as _0x3865cd,MenuBarMenuListItemFileDialogButtonView as _0x5d87c6,SpinnerView as _0x5231f8,Notification as _0x554933}from'@ckeditor/ckeditor5-ui/dist/index.js';import{ClipboardPipeline as _0x32a25b}from'@ckeditor/ckeditor5-clipboard/dist/index.js';import{ModelRange as _0x22a347}from'@ckeditor/ckeditor5-engine/dist/index.js';import{first as _0x4ed8b3,uid as _0x598c12,logWarning as _0x551e82,logError as _0x4ea8ca}from'@ckeditor/ckeditor5-utils/dist/index.js';function c(_0x577819,_0xd4902b){const t=_0x577819['t'];switch(_0xd4902b){case'Import\x20from\x20Word':return t('Import\x20from\x20Word');case'An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.':return t('An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.');case'Importing\x20Word\x20document':return t('Importing\x20Word\x20document');default:return _0xd4902b;}}class i extends _0x5221e4{static get['pluginName'](){return'ImportWordUI';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}['init'](){const _0x2939ba=this['editor'];_0x2939ba['ui']['componentFactory']['add']('importWord',()=>{const _0xfd6d8a=this['_createButton'](_0x3865cd),_0x12622d=_0x2939ba['commands']['get']('importWord');return _0xfd6d8a['bind']('isOn')['to'](_0x12622d,'isBusy'),_0xfd6d8a['tooltip']=!0x0,_0xfd6d8a;}),_0x2939ba['ui']['componentFactory']['add']('menuBar:importWord',()=>this['_createButton'](_0x5d87c6));}['_createButton'](_0x51ef6b){const _0x37d51d=this['editor'],_0x1489dd=_0x37d51d['commands']['get']('importWord'),_0x46acf9=new _0x51ef6b(_0x37d51d['locale']),_0x38a080=new _0x5231f8();return _0x46acf9['set']({'acceptedType':'application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.wordprocessingml.template'}),_0x46acf9['set']({'icon':_0x21e6a6}),_0x46acf9['bind']('isEnabled')['to'](_0x1489dd),_0x46acf9['bind']('label')['to'](_0x1489dd,'isBusy',_0x5d6654=>c(_0x37d51d['locale'],_0x5d6654?'Importing\x20Word\x20document':'Import\x20from\x20Word')),_0x38a080['bind']('isVisible')['to'](_0x1489dd,'isBusy'),_0x46acf9['iconView']['bind']('isVisible')['to'](_0x1489dd,'isBusy',_0x35e90a=>!_0x35e90a),_0x46acf9['children']['add'](_0x38a080),_0x46acf9['on']('done',(_0x3f3507,_0x588e43)=>{_0x37d51d['execute']('importWord',_0x588e43[0x0],{}),_0x37d51d['editing']['view']['focus']();}),_0x46acf9;}}class u extends _0x1b08f6{['_importMarker'];['_undoStepBatch'];['_abortController'];constructor(_0x41d2cc){super(_0x41d2cc),this['set']('isBusy',!0x1),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['on']('dataInsert',(_0x549e89,_0x4c03e8)=>{const _0x598853=new DataTransfer();_0x598853['setData']('text/html',_0x4c03e8['html']);const _0xa2e87f=this['_importMarker']['getRange']();this['editor']['model']['enqueueChange'](this['_undoStepBatch'],_0x5875c1=>{this['_importMarker']['stopListening'](),_0x5875c1['setSelection'](_0xa2e87f),_0x41d2cc['editing']['view']['document']['fire']('clipboardInput',{'dataTransfer':_0x598853});});},{'priority':'low'});}['refresh'](){this['isEnabled']=this['_checkEnabled']();}['execute'](_0x5a213b,_0x55dedf={}){if(this['isBusy'])return Promise['resolve']();const _0x1147fd=this['editor']['config']['get']('importWord');if(this['editor']['plugins']['has']('MergeFields')){const {prefix:_0x31f258,suffix:_0x4c762e}=this['editor']['config']['get']('mergeFields');_0x55dedf['merge_fields']={'prefix':_0x31f258,'suffix':_0x4c762e};}const _0x372fa9={'url':_0x1147fd['converterUrl'],'file':_0x5a213b,'serviceConfig':{..._0x55dedf,'formatting':_0x1147fd['formatting'],'timezone':new Intl['DateTimeFormat']()['resolvedOptions']()['timeZone']}};return this['_prepareForImport'](),this['_sendImportRequest'](_0x372fa9)['then'](this['_handleImportResponse']['bind'](this))['catch'](this['_handleImportFailure']['bind'](this))['finally'](this['_cleanUpAfterImport']['bind'](this));}['_checkEnabled'](){if(this['isBusy'])return!0x1;const _0x3d1cbc=this['editor']['model'],_0x627cd9=_0x3d1cbc['schema'],_0x388d86=_0x3d1cbc['document']['selection'],_0x429493=_0x4ed8b3(_0x388d86['getSelectedBlocks']());return!!_0x429493&&_0x627cd9['checkChild'](_0x429493['parent'],'paragraph');}['_prepareForImport'](){const _0x20529f=this['editor'],_0x5003f0=_0x20529f['model'],_0x38d69e=_0x5003f0['document']['selection'];this['_abortController']=new AbortController(),this['_undoStepBatch']=_0x20529f['model']['createBatch']({'isUndoable':!0x0}),_0x5003f0['enqueueChange'](this['_undoStepBatch'],_0x253dec=>{_0x38d69e['isCollapsed']||_0x5003f0['deleteContent'](_0x38d69e,{'leaveUnmerged':!0x0});const _0x222654=_0x38d69e['getFirstPosition'](),_0x30d44c=_0x4ed8b3(_0x38d69e['getSelectedBlocks']());let _0x49055b;_0x49055b=_0x30d44c['is']('element','paragraph')&&_0x30d44c['isEmpty']?_0x222654:_0x222654['isAtStart']?_0x5003f0['createPositionBefore'](_0x30d44c):_0x222654['isAtEnd']?_0x5003f0['createPositionAfter'](_0x30d44c):_0x253dec['split'](_0x222654)['position'],this['_importMarker']=_0x253dec['addMarker']('importWord:'+_0x598c12(),{'usingOperation':!0x1,'affectsData':!0x1,'range':new _0x22a347(_0x49055b)}),this['_importMarker']['on']('change:range',()=>{'$graveyard'===this['_importMarker']['getRange']()['root']['rootName']&&this['_abortController']['abort']();});}),this['isBusy']=!0x0,this['refresh']();}['_cleanUpAfterImport'](){const _0x2be8a5=this['editor']['model'];_0x2be8a5['markers']['has'](this['_importMarker'])&&_0x2be8a5['enqueueChange'](this['_undoStepBatch'],_0x520e75=>{_0x520e75['removeMarker'](this['_importMarker']);}),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['isBusy']=!0x1,this['refresh']();}['_sendImportRequest']({url:_0x4969c5,file:_0x22aa64,serviceConfig:_0x4aafd9}){const _0x88175d=this['editor']['plugins']['get']('ImportWordEditing')['getToken'](),_0x4ce6d5=new FormData();_0x4ce6d5['set']('config',JSON['stringify'](_0x4aafd9)),_0x4ce6d5['set']('file',_0x22aa64);const _0x1806f8={'method':'POST','headers':{},'body':_0x4ce6d5,'signal':this['_abortController']['signal']};return _0x88175d&&(_0x1806f8['headers']['Authorization']=_0x88175d['value']),fetch(_0x4969c5,_0x1806f8);}['_handleImportResponse'](_0x326ecb){return _0x326ecb['ok']?_0x326ecb['json']()['then'](_0xd3ef6a=>{if(!this['editor']['model']['markers']['has'](this['_importMarker']))return;'$graveyard'!==this['_importMarker']['getRange']()['root']['rootName']&&this['fire']('dataInsert',_0xd3ef6a);}):Promise['reject']();}['_handleImportFailure'](){if(this['_abortController']['signal']['aborted'])return void _0x551e82('import-word-plugin-import-cancelled');const _0x12c927=this['editor'],_0x10aeca=c(_0x12c927['locale'],'An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.');_0x12c927['plugins']['get']('Notification')['showWarning'](_0x10aeca),_0x4ea8ca('import-word-plugin-conversion-failed');}}class e extends _0x5221e4{['_token'];static get['pluginName'](){return'ImportWordEditing';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}static get['requires'](){return[_0x554933,_0x32a25b,'CloudServices'];}constructor(_0xb30bb8){super(_0xb30bb8),this['_token']=null;}async['init'](){const _0x8e3569=this['editor'];_0x8e3569['config']['define']('importWord',{'converterUrl':'https://docx-converter.cke-cs.com/v2/convert/docx-html','tokenUrl':(_0x8e3569['config']['get']('cloudServices')||{})['tokenUrl'],'formatting':{'resets':'none','defaults':'none','styles':'inline'}}),_0x8e3569['commands']['add']('importWord',new u(_0x8e3569));const {tokenUrl:_0x2e45e0}=_0x8e3569['config']['get']('importWord');if(_0x2e45e0){const {tokenUrl:_0x11e5fb}=_0x8e3569['config']['get']('cloudServices')||{};this['_token']=_0x2e45e0===_0x11e5fb?_0x8e3569['plugins']['get']('CloudServices')['token']:await _0x8e3569['plugins']['get']('CloudServices')['registerTokenUrl'](_0x2e45e0);}}['getToken'](){return this['_token'];}}class x extends _0x5221e4{static get['pluginName'](){return'ImportWord';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}static get['requires'](){return[e,i];}}export{x as ImportWord,u as ImportWordCommand,e as ImportWordEditing,i as ImportWordUI};