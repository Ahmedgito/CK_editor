/*
 *             Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x3a12e4}from'ckeditor5/src/core.js';import{FileRepository as _0x3dd152}from'ckeditor5/src/upload.js';import{UploadcareEditing as _0x508652}from'./uploadcareediting.js';import{UploadUtils as _0x5c0340}from'./utils/uploadutils.js';import{getImageUrls as _0x2f393e}from'./utils/editingutils.js';export class UploadcareUploadAdapter extends _0x3a12e4{static get['requires'](){return['ImageUploadEditing','ImageUploadProgress',_0x3dd152,_0x508652];}static get['pluginName'](){return'UploadcareUploadAdapter';}static get['isOfficialPlugin'](){return!0x0;}static get['isPremiumPlugin'](){return!0x0;}async['afterInit'](){const _0x1a8a92=this['editor'];if(!!!_0x1a8a92['config']['get']('uploadcare'))return;_0x1a8a92['plugins']['get'](_0x3dd152)['createUploadAdapter']=_0x5f284c=>new k(_0x5f284c,_0x1a8a92),_0x1a8a92['plugins']['get']('ImageUploadEditing')['on']('uploadComplete',(_0x1c99d0,{imageElement:_0x56e6ed,data:_0x13172d})=>{_0x1a8a92['model']['change'](_0x38dc77=>{_0x38dc77['setAttribute']('uploadcareImageId',_0x13172d['uploadcareImageId'],_0x56e6ed);});});}}class k{['loader'];['editor'];['controller'];constructor(_0x486e13,_0xa859b1){this['loader']=_0x486e13,this['editor']=_0xa859b1,this['controller']=new AbortController();}async['upload'](){const t=this['editor']['t'],_0x37d731=await this['loader']['file'];return _0x5c0340['upload']({'file':_0x37d731,'publicKey':this['editor']['config']['get']('uploadcare.pubkey'),'baseURL':this['editor']['config']['get']('uploadcare.uploader.baseUrl'),'baseCDN':this['editor']['config']['get']('uploadcare.uploader.cdnCname'),'signal':this['controller']['signal'],'onProgress':_0x35de96=>{_0x35de96&&_0x35de96['isComputable']&&(this['loader']['uploadTotal']=0x1,this['loader']['uploaded']=_0x35de96['value']);}})['then'](async _0xe6a64d=>{const {imageFallbackUrl:_0x29e119,imageSources:_0x2dc0d3}=_0x2f393e(_0xe6a64d['cdnUrl'],_0xe6a64d['imageInfo']['width']);return{'uploadcareImageId':_0xe6a64d['uuid'],'default':_0x29e119,'sources':_0x2dc0d3};})['catch'](()=>{const _0x2ebcda=t('Cannot\x20upload\x20file:')+('\x20'+_0x37d731['name']+'.');return Promise['reject'](_0x2ebcda);});}['abort'](){this['controller']['abort']();}}